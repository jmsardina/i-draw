$(function(){
  setUpEnvironment();
  var paint;
  mouseCoordinates = new Array();
});

function listenOnMouse(){
  $("#canvas").on("mousedown", mouseDown);

  function mouseDown(e){
    paint = true;
    mouseCoordinates.push([e.offsetX, e.offsetY]);
    $(this).on("mousemove", mouseMove);
  }

  function mouseMove(e){
    if(paint){
      mouseCoordinates.push([e.offsetX, e.offsetY]);
      $(this).on("mouseup", mouseUp);
      draw(e);
    }
  }

  function mouseUp(e){
    paint = false;
  }
}

function draw(e){
  if(paint){
    context.beginPath();
    context.lineJoin = "round";
    context.lineCap = "round";

    context.moveTo(mouseCoordinates[mouseCoordinates.length-2][0], mouseCoordinates[mouseCoordinates.length-2][1])
    context.lineTo(mouseCoordinates[mouseCoordinates.length-1][0], mouseCoordinates[mouseCoordinates.length-1][1])
    context.stroke();
  }
}

function listenOnCanvasClearing(){
  $("#eraser").on("click", erasing);
  $("#start-over").on("click", clearCanvas);
  $("#remove-image").on("click", removeImage);

  function erasing(){
    context.globalCompositeOperation = "destination-out";
    $("#canvas").attr("class", "erasing");
  }
 
  function clearCanvas(){
    if(confirm("We're about to erase your picture!")){
      context.clearRect(0, 0, canvas.width, canvas.height);
    }
  }

  function removeImage(){
    imageHolderContext.clearRect(0, 0, canvas.width, canvas.height);
  }
}